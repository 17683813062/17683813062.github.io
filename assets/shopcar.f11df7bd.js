var T=Object.defineProperty,B=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var j=(a,n,e)=>n in a?T(a,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[n]=e,E=(a,n)=>{for(var e in n||(n={}))M.call(n,e)&&j(a,e,n[e]);if(S)for(var e of S(n))N.call(n,e)&&j(a,e,n[e]);return a},F=(a,n)=>B(a,x(n));import{_ as U,b as R,d as I,r as P,o as A,e as D,t as J,a as v,c as L,f as p,w as C,ag as G,ah as q,g as i,F as z,C as H,n as O,a8 as K,aE as Q,aF as W,i as w,j as d,M as X,aG as Y}from"./index.3f80cc32.js";import{g as Z,a as $}from"./utils.5cf54832.js";const ee={beforeRouteEnter(a,n,e){e(r=>{r.store.commit("changeFooter",!1)})},setup(){let a=R(),n=I(),e=P({store:a,timer:null,user:JSON.parse(localStorage.getItem("user")),shopList:[],flag:!0,checked:!1,price:0,type:"\u5168\u9009"}),r=async c=>{if(c.length==0){X.error("\u8BF7\u9009\u62E9\u4E00\u9879");return}let{price:o,user:s}=e,t={list:c,price:o,username:s.username,user:s,timestamp:Z(),time:$()},l=await Y(t);n.push({path:"/orderlist"}),console.log(l,"\u63D0\u4EA4\u8BA2\u5355")},y=()=>{let o=e.shopList.filter(s=>s.check);console.log(o,"\u9009\u4E2D\u7684\u8BA2\u5355"),r(o)},V=(c,o)=>{let s=e.shopList,t=0,l=0;console.log(s),s.forEach(u=>{u.check&&(l++,t+=u.count*u.goodsObj.price)}),console.log(s),e.shopList=s,e.price=t*100,l==e.shopList.length?e.checked=!0:(e.checked=!1,e.type="\u5355\u9009")},_=c=>{if(c){e.type="\u5168\u9009";let o=e.shopList,s=0;o.forEach(t=>{t.check=!0,t.check&&(s+=t.count*t.goodsObj.price)}),e.shopList=o,e.price=s*100}else if(e.type!="\u5355\u9009"){let o=e.shopList,s=0;o.forEach(t=>{t.check=!1,t.check&&(s+=t.count*t.goodsObj.price)}),e.shopList=o,e.price=s*100}},m=()=>!!e.flag,g=(c,o,s,t)=>{e.flag&&(e.flag=!1,e.timer=setTimeout(()=>{e.flag=!0,K({_id:s,username:e.user.username}).then(l=>{if(console.log(l,"\u6570\u91CF\u52A01"),t){let u=e.shopList,f=0;u.forEach(h=>{h.check&&(f+=h.count*h.goodsObj.price)}),e.price=f*100}}),clearTimeout(e.timer)},1e3))},k=(c,o,s,t)=>{e.flag&&(e.flag=!1,e.timer=setTimeout(()=>{e.flag=!0,Q({_id:s,username:e.user.username}).then(l=>{if(console.log(l,"\u6570\u91CF\u51CF1"),t){let u=e.shopList,f=0;u.forEach(h=>{h.check&&(f+=h.count*h.goodsObj.price)}),e.price=f*100}}),clearTimeout(e.timer)},1e3))},b=async()=>{let c=await W({username:e.user.username}),o=c.result;o.forEach(s=>{s.check=!1}),e.shopList=o,console.log(c,"\u8D2D\u7269\u8F66")};return A(()=>{b()}),D((c,o)=>{a.commit("changeFooter",!0)}),F(E({},J(e)),{getCountChange:g,minusCountFunc:k,countBeforeChange:m,checkAll:_,checkOne:V,onSubmit:y})}},oe=w(" \u8D2D\u7269\u8F66 "),te={class:"shopCar"},se={class:"checkbox"},ae={class:"left"},ne={class:"center"},ce={style:{color:"red"}},re={class:"sl"},le={class:"right"},ie=w("\u5168\u9009");function ue(a,n,e,r,y,V){const _=d("t-navbar"),m=d("van-empty"),g=d("van-checkbox"),k=d("van-image"),b=d("van-stepper"),c=d("van-submit-bar");return v(),L("div",null,[p(_,null,{default:C(()=>[oe]),_:1}),G(p(m,{description:"\u60A8\u7684\u8D2D\u7269\u8F66\u662F\u7A7A\u7684"},null,512),[[q,a.shopList.length==0]]),i("ul",te,[(v(!0),L(z,null,H(a.shopList,(o,s)=>(v(),L("li",{key:s},[i("div",se,[p(g,{onClick:t=>r.checkOne(t,o._id),modelValue:o.check,"onUpdate:modelValue":t=>o.check=t,name:"a"},null,8,["onClick","modelValue","onUpdate:modelValue"])]),i("div",ae,[p(k,{fit:"cover",width:"90",height:"110",src:JSON.parse(o.goodsObj.bannerList)[0].url},null,8,["src"])]),i("div",ne,[i("p",ce,"\uFFE5"+O(o.goodsObj.price),1),i("h6",null,O(o.goodsObj.title),1),i("p",re,O(o.goodsObj.desc),1)]),i("div",le,[p(b,{"before-change":r.countBeforeChange,onMinus:t=>r.minusCountFunc(t,o.count,o.Id,o.check),onPlus:t=>r.getCountChange(t,o.count,o.Id,o.check),modelValue:o.count,"onUpdate:modelValue":t=>o.count=t,"disable-input":""},null,8,["before-change","onMinus","onPlus","modelValue","onUpdate:modelValue"])])]))),128))]),p(c,{price:a.price,"button-text":"\u63D0\u4EA4\u8BA2\u5355",onSubmit:r.onSubmit},{default:C(()=>[p(g,{onChange:r.checkAll,modelValue:a.checked,"onUpdate:modelValue":n[0]||(n[0]=o=>a.checked=o)},{default:C(()=>[ie]),_:1},8,["onChange","modelValue"])]),_:1},8,["price","onSubmit"])])}var fe=U(ee,[["render",ue]]);export{fe as default};
