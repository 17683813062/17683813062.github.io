var F=Object.defineProperty,T=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var O=(e,o,t)=>o in e?F(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,_=(e,o)=>{for(var t in o||(o={}))H.call(o,t)&&O(e,t,o[t]);if(j)for(var t of j(o))B.call(o,t)&&O(e,t,o[t]);return e},L=(e,o)=>T(e,D(o));import{am as J,_ as C,f as I,r as k,an as v,U as S,o as M,t as y,a as m,c as u,e as l,F as E,p as U,ao as f,n as b,q as R,j as g,C as V,d as p,w as $,i as w,b as z,u as G,ap as x}from"./index.ea3e0c12.js";import{w as q}from"./wangEditor.e3238ebc.js";var h={socketUrl:J,socket:null,store:null,leave:null,join:null,initRoom:function(e,o,t){this.socket=window.io.connect(this.socketUrl),this.store=t,this.socket.on("connect",()=>{console.log("\u8FDE\u63A5\u6210\u529F"),this.joinRoom(e,o),this.eventData()}),this.socket.on("connecting",()=>{console.log("\u6B63\u5728\u8FDE\u63A5")}),this.socket.on("disconnect",()=>{console.log("\u65AD\u5F00\u8FDE\u63A5")}),this.socket.on("connect_failed",()=>{console.log("\u8FDE\u63A5\u5931\u8D25")}),this.socket.on("error",()=>{console.log("\u9519\u8BEF\u53D1\u751F\uFF0C\u5E76\u4E14\u65E0\u6CD5\u88AB\u5176\u4ED6\u4E8B\u4EF6\u7C7B\u578B\u6240\u5904\u7406")}),this.socket.on("reconnect_failed",()=>{console.log("\u91CD\u8FDE\u5931\u8D25")}),this.socket.on("reconnect",()=>{console.log("\u6210\u529F\u91CD\u8FDE")}),this.socket.on("reconnecting",()=>{console.log("\u6B63\u5728\u91CD\u8FDE")})},joinRoom(e,o){let t={chatId:e,user:o};this.socket.emit("JOINROOM",t),this.socket.on("joinroom",s=>{this.store.commit("joinRoom",s),this.join=!0})},eventData(){this.socket.on("broadcast",e=>{this.store.commit("saveChatList",e)}),this.socket.on("leavebroadcast",e=>{this.store.commit("leaveRoom",e),this.leave=!0})}};const A={name:"ChatContent",props:{chatId:Number},setup(e,o){let t=I(),s=k({msgList:[],manList:[],user:JSON.parse(localStorage.getItem("user"))});return setTimeout(()=>{v(()=>s.msgList,(i,c)=>{console.log("\u6539\u53D8\u4FE1\u606F112121"),o.emit("changeMsgList")})},1e3),v(()=>t.state.chatRoom,(i,c)=>{console.log(i,"new");let r=i.filter(n=>n.chatId==e.chatId);s.msgList=r[0].msgList,s.manList=r[0].manList,o.emit("getManList",r[0].manList),o.emit("leaveRoom"),S(()=>{})},{deep:!0}),M(()=>{}),_({},y(s))}},K={ref:"chatDom",class:"chatBox"},P={class:"top"},Q=["src"],W=["innerHTML"],X=["innerHTML"];function Y(e,o,t,s,i,c){return m(),u("div",null,[l("ul",K,[(m(!0),u(E,null,U(e.msgList,(a,r)=>(m(),u("li",{class:f(e.user.username==a.user.username?"chat-item myitem":"chat-item"),key:r},[l("div",P,[l("img",{src:a.user.headImg,alt:""},null,8,Q),l("span",null,b(a.user.username),1)]),a.type=="text"?(m(),u("div",{key:0,class:f(a.type=="text"?"btm text":"btm")},[l("span",{innerHTML:a.text},null,8,W)],2)):R("",!0),a.type=="broadcast"?(m(),u("div",{key:1,class:f(a.type=="broadcast"?"btm broadcast":"btm")},[l("span",{innerHTML:a.text},null,8,X)],2)):R("",!0)],2))),128))],512)])}var Z=C(A,[["render",Y],["__scopeId","data-v-dbec75f6"]]);const tt={name:"ChatFoot",props:{_id:String},setup(e,o){let t=k({editor:null,editorContent:"",editorMaxHeight:0}),s=()=>{t.editorMaxHeight=window.innerHeight-450,t.editor=new q("#toolbar-container","#text-container"),t.editor.config.onchange=function(c){t.editorContent=c},t.editor.create()},i=()=>{o.emit("sendMsg",t.editor.txt.html()),t.editor.txt.html("")};return M(()=>{S(()=>{s()})}),L(_({},y(t)),{send:i})}},et=l("div",{id:"toolbar-container",class:"toolbar"},null,-1),ot=w("\u53D1\u9001");function st(e,o,t,s,i,c){const a=g("t-button");return m(),u("div",null,[et,l("div",{id:"text-container",style:V("height:"+e.editorMaxHeight/100+"rem"),class:"text"},null,4),p(a,{onClick:s.send,style:{position:"fixed",right:"0.2rem",bottom:"0.1rem"},size:"small",theme:"primary"},{default:$(()=>[ot]),_:1},8,["onClick"])])}var nt=C(tt,[["render",st]]);const at={components:{ChatContent:Z,ChatFoot:nt},beforeRouteEnter(e,o,t){t(s=>{s.store.commit("changeFooter",!1)})},setup(){let e=G(),o=I(),t=k({store:o,user:JSON.parse(localStorage.getItem("user")),_id:e.query._id,chatObj:{chatId:"",name:"",desc:"",movice:"",_id:""},length:0}),s=async()=>{},i=async()=>{let n=setTimeout(async()=>{let d=await x({_id:t._id});t.chatObj=d.result[0],t.chatObj.manList=JSON.parse(d.result[0].manList),t.length=t.chatObj.manList.length,clearTimeout(n),console.log("\u6539\u53D8\u4FE1\u606F\u5217\u8868",t.chatObj.manList)},2e3)},c=async n=>{t.manList=n},a=n=>{let d={chatId:t.chatObj.chatId,text:n,type:"text",user:t.user};h.socket.emit("SENDMSG",d)},r=async()=>{let n=await x({_id:t._id});t.chatObj=n.result[0],t.chatObj.manList=JSON.parse(n.result[0].manList),t.length=t.chatObj.manList.length,h.initRoom(t.chatObj.chatId,t.user,o)};return M(()=>{r()}),v(()=>h.join,(n,d)=>{console.log("\u52A0\u5165666666"),n&&(console.log("\u52A0\u5165666666"),h.join=null)},{deep:!0}),v(()=>h.leave,(n,d)=>{n&&(console.log("\u79BB\u5F00666666"),h.leave=null)},{deep:!0}),z((n,d)=>{let N={chatId:t.chatObj.chatId,user:t.user};h.socket.emit("disconnected",N),o.commit("changeFooter",!0)}),L(_({},y(t)),{sendMsg:a,getManList:c,changeMsgList:s,leaveRoom:i})}},it={class:"chatDetail"};function rt(e,o,t,s,i,c){const a=g("t-navbar"),r=g("ChatContent"),n=g("ChatFoot");return m(),u("div",it,[p(a,null,{default:$(()=>[w(b(e.chatObj.name)+" "+b("("+e.length+")"),1)]),_:1}),p(r,{onLeaveRoom:s.leaveRoom,onChangeMsgList:s.changeMsgList,onGetManList:s.getManList,chatId:e.chatObj.chatId,class:"ChatContent"},null,8,["onLeaveRoom","onChangeMsgList","onGetManList","chatId"]),p(n,{onSendMsg:s.sendMsg,_id:e._id,class:"ChatFoot"},null,8,["onSendMsg","_id"])])}var ht=C(at,[["render",rt],["__scopeId","data-v-61fd50ef"]]);export{ht as default};
