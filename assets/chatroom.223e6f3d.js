var S=Object.defineProperty,N=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var A=(e,o,t)=>o in e?S(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,v=(e,o)=>{for(var t in o||(o={}))$.call(o,t)&&A(e,t,o[t]);if(j)for(var t of j(o))q.call(o,t)&&A(e,t,o[t]);return e},C=(e,o)=>N(e,T(o));import{ap as H,_ as y,L as V,f as R,r as B,aq as b,U as O,o as M,t as D,a as r,c as d,e as c,F as z,p as J,ar as k,n as F,q as L,j as _,C as W,d as f,w as I,i as w,b as U,as as G,v as P,u as K,at as E}from"./index.ef4f3cae.js";import{w as Q}from"./wangEditor.840faf33.js";var g={socketUrl:H,socket:null,store:null,leave:null,join:null,initRoom:function(e,o,t){this.socket=window.io.connect(this.socketUrl),this.store=t,this.socket.on("connect",()=>{console.log("\u8FDE\u63A5\u6210\u529F"),this.joinRoom(e,o),this.eventData()}),this.socket.on("connecting",()=>{console.log("\u6B63\u5728\u8FDE\u63A5")}),this.socket.on("disconnect",()=>{console.log("\u65AD\u5F00\u8FDE\u63A5")}),this.socket.on("connect_failed",()=>{console.log("\u8FDE\u63A5\u5931\u8D25")}),this.socket.on("error",()=>{console.log("\u9519\u8BEF\u53D1\u751F\uFF0C\u5E76\u4E14\u65E0\u6CD5\u88AB\u5176\u4ED6\u4E8B\u4EF6\u7C7B\u578B\u6240\u5904\u7406")}),this.socket.on("reconnect_failed",()=>{console.log("\u91CD\u8FDE\u5931\u8D25")}),this.socket.on("reconnect",()=>{console.log("\u6210\u529F\u91CD\u8FDE")}),this.socket.on("reconnecting",()=>{console.log("\u6B63\u5728\u91CD\u8FDE")})},joinRoom(e,o){let t={chatId:e,user:o};this.socket.emit("JOINROOM",t),this.socket.on("joinroom",s=>{this.store.commit("joinRoom",s),this.join=!0})},eventData(){this.socket.on("broadcast",e=>{this.store.commit("saveChatList",e)}),this.socket.on("leavebroadcast",e=>{this.store.commit("leaveRoom",e),this.leave=!0})}};const X={name:"ChatContent",props:{chatId:Number},setup(e,o){let t=V(null),s=R(),i=B({msgList:[],manList:[],user:JSON.parse(localStorage.getItem("user"))}),l=setTimeout(()=>{b(()=>i.msgList,(a,h)=>{console.log("\u6539\u53D8\u4FE1\u606F112121"),o.emit("changeMsgList"),clearTimeout(l)})},1e3);return b(()=>s.state.chatRoom,(a,h)=>{console.log(a,"new");let m=a.filter(n=>n.chatId==e.chatId);i.msgList=m[0].msgList,i.manList=m[0].manList,o.emit("getManList",m[0].manList),o.emit("leaveRoom"),O(()=>{t.value.scrollTop=t.value.scrollHeight})},{deep:!0}),M(()=>{}),C(v({},D(i)),{chatDom:t})}},Y={ref:"chatDom",class:"chatBox"},Z={class:"top"},tt=["src"],et=["innerHTML"],ot=["innerHTML"];function st(e,o,t,s,i,l){return r(),d("div",null,[c("ul",Y,[(r(!0),d(z,null,J(e.msgList,(a,h)=>(r(),d("li",{class:k(e.user.username==a.user.username?"chat-item myitem":"chat-item"),key:h},[c("div",Z,[c("img",{src:a.user.headImg,alt:""},null,8,tt),c("span",null,F(a.user.username),1)]),a.type=="text"?(r(),d("div",{key:0,class:k(a.type=="text"?"btm text":"btm")},[c("span",{innerHTML:a.text},null,8,et)],2)):L("",!0),a.type=="broadcast"?(r(),d("div",{key:1,class:k(a.type=="broadcast"?"btm broadcast":"btm")},[c("span",{innerHTML:a.text},null,8,ot)],2)):L("",!0)],2))),128))],512)])}var at=y(X,[["render",st],["__scopeId","data-v-50c1a339"]]);const nt={name:"ChatFoot",props:{_id:String},setup(e,o){let t=B({editor:null,editorContent:"",editorMaxHeight:0,footFlag:!1}),s=()=>{t.editorMaxHeight=window.innerHeight-600,t.editor=new Q("#toolbar-container","#text-container"),t.editor.config.onchange=function(l){t.editorContent=l},t.editor.create()},i=()=>{o.emit("sendMsg",t.editor.txt.html()),t.editor.txt.html("")};return M(()=>{O(()=>{s()})}),C(v({},D(t)),{send:i})}},it=c("div",{id:"toolbar-container",class:"toolbar"},null,-1),rt=w("\u53D1\u9001");function lt(e,o,t,s,i,l){const a=_("t-button");return r(),d("div",null,[it,c("div",{id:"text-container",style:W("height:"+e.editorMaxHeight/100+"rem"),class:"text"},null,4),f(a,{onClick:s.send,style:{position:"fixed",right:"0.2rem",bottom:"0.1rem"},size:"small",theme:"primary"},{default:I(()=>[rt]),_:1},8,["onClick"])])}var ct=y(nt,[["render",lt]]);const dt={components:{ChatContent:at,ChatFoot:ct},beforeRouteEnter(e,o,t){t(s=>{s.store.commit("changeFooter",!1)})},setup(){let e=K(),o=R(),t=B({store:o,user:JSON.parse(localStorage.getItem("user")),_id:e.query._id,chatObj:{chatId:"",name:"",desc:"",movice:"",_id:""},length:0,footFlag:!1,options:{width:"100%",height:"3.5rem",color:"#409eff",title:"",src:"https://apd-vlive.apdcdn.tc.qq.com/vipzj.video.tc.qq.com/gzc_1000102_0b53buaacaaauyabnr7uvbq4adodaeaqabka.f2.mp4?vkey=C5C78AC0AC344C66940B634E48598931E04FE68BD2656F5707120E08EABBF9B54608D90C80C30E0F8FA9C5F04B98D26AC15B57DAAAD40B4DF40B27BE9CEADAFD041A914986E0E0612FFCB8C942BF883A63585A508BB0A5ADA123CE09F94F3396F87D7C8BCE0744055B34B48F141C1E5BFE0A08FE3396520D3D63C1B5AEC26D93ADDCE37AB1B9B1B7"}}),s=()=>{t.footFlag=!1},i=()=>{t.footFlag=!0},l=async()=>{},a=async()=>{let n=setTimeout(async()=>{let u=await E({_id:t._id});t.chatObj=u.result[0],t.chatObj.manList=JSON.parse(u.result[0].manList),t.length=t.chatObj.manList.length,clearTimeout(n),console.log("\u6539\u53D8\u4FE1\u606F\u5217\u8868",t.chatObj.manList)},2e3)},h=async n=>{t.manList=n},p=n=>{let u={chatId:t.chatObj.chatId,text:n,type:"text",user:t.user};g.socket.emit("SENDMSG",u),t.footFlag=!1},m=async()=>{let n=await E({_id:t._id});t.chatObj=n.result[0],t.chatObj.manList=JSON.parse(n.result[0].manList),t.length=t.chatObj.manList.length,g.initRoom(t.chatObj.chatId,t.user,o)};return M(()=>{m()}),b(()=>g.join,(n,u)=>{console.log("\u52A0\u5165666666"),n&&(console.log("\u52A0\u5165666666"),g.join=null)},{deep:!0}),b(()=>g.leave,(n,u)=>{n&&(console.log("\u79BB\u5F00666666"),g.leave=null)},{deep:!0}),U((n,u)=>{let x={chatId:t.chatObj.chatId,user:t.user};g.socket.emit("disconnected",x),o.commit("changeFooter",!0)}),C(v({},D(t)),{sendMsg:p,getManList:h,changeMsgList:l,leaveRoom:a,goWrite:i,hideWrite:s})}},ht={class:"chatDetail"};function mt(e,o,t,s,i,l){const a=_("t-navbar"),h=_("vue3VideoPlay"),p=_("ChatContent"),m=_("ChatFoot");return r(),d("div",ht,[f(a,{onClickRight:s.hideWrite},{default:I(()=>[w(F(e.chatObj.name)+" "+F("("+e.length+")"),1)]),_:1},8,["onClickRight"]),f(h,G({style:{width:"100%",height:"3.5rem"}},e.options),null,16),f(p,{onLeaveRoom:s.leaveRoom,onChangeMsgList:s.changeMsgList,onGetManList:s.getManList,chatId:e.chatObj.chatId,class:"ChatContent"},null,8,["onLeaveRoom","onChangeMsgList","onGetManList","chatId"]),e.footFlag?(r(),P(m,{key:0,onSendMsg:s.sendMsg,_id:e._id,class:"ChatFoot"},null,8,["onSendMsg","_id"])):L("",!0),e.footFlag?L("",!0):(r(),d("div",{key:1,onClick:o[0]||(o[0]=(...n)=>s.goWrite&&s.goWrite(...n)),class:"inputFalse"},"\u8BF7\u8F93\u5165\u4FE1\u606F"))])}var pt=y(dt,[["render",mt],["__scopeId","data-v-ea9b0412"]]);export{pt as default};
