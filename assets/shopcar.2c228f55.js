var x=Object.defineProperty,B=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var j=(a,c,e)=>c in a?x(a,c,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[c]=e,E=(a,c)=>{for(var e in c||(c={}))M.call(c,e)&&j(a,e,c[e]);if(S)for(var e of S(c))N.call(c,e)&&j(a,e,c[e]);return a},F=(a,c)=>B(a,w(c));import{_ as U,b as R,d as I,r as P,o as A,e as D,t as J,a as v,c as L,f as p,w as C,g as i,F as z,z as q,n as O,a5 as G,aC as H,aD as K,i as T,j as f,M as Q,aE as W}from"./index.bd460a8a.js";import{g as X,a as Y}from"./utils.5cf54832.js";const Z={beforeRouteEnter(a,c,e){e(r=>{r.store.commit("changeFooter",!1)})},setup(){let a=R(),c=I(),e=P({store:a,timer:null,user:JSON.parse(localStorage.getItem("user")),shopList:[],flag:!0,checked:!1,price:0,type:"\u5168\u9009"}),r=async t=>{if(t.length==0){Q.error("\u8BF7\u9009\u62E9\u4E00\u9879");return}let{price:s,user:o}=e,n={list:t,price:s,username:o.username,user:o,timestamp:X(),time:Y()},l=await W(n);c.push({path:"/orderlist"}),console.log(l,"\u63D0\u4EA4\u8BA2\u5355")},V=()=>{let s=e.shopList.filter(o=>o.check);console.log(s,"\u9009\u4E2D\u7684\u8BA2\u5355"),r(s)},y=(t,s)=>{let o=e.shopList,n=0,l=0;console.log(o),o.forEach(u=>{u.check&&(l++,n+=u.count*u.goodsObj.price)}),console.log(o),e.shopList=o,e.price=n*100,l==e.shopList.length?e.checked=!0:(e.checked=!1,e.type="\u5355\u9009")},_=t=>{if(t){e.type="\u5168\u9009";let s=e.shopList,o=0;s.forEach(n=>{n.check=!0,n.check&&(o+=n.count*n.goodsObj.price)}),e.shopList=s,e.price=o*100}else if(e.type!="\u5355\u9009"){let s=e.shopList,o=0;s.forEach(n=>{n.check=!1,n.check&&(o+=n.count*n.goodsObj.price)}),e.shopList=s,e.price=o*100}},g=()=>!!e.flag,m=(t,s,o,n)=>{e.flag&&(e.flag=!1,e.timer=setTimeout(()=>{e.flag=!0,G({_id:o,username:e.user.username}).then(l=>{if(console.log(l,"\u6570\u91CF\u52A01"),n){let u=e.shopList,d=0;u.forEach(h=>{h.check&&(d+=h.count*h.goodsObj.price)}),e.price=d*100}}),clearTimeout(e.timer)},1e3))},k=(t,s,o,n)=>{e.flag&&(e.flag=!1,e.timer=setTimeout(()=>{e.flag=!0,H({_id:o,username:e.user.username}).then(l=>{if(console.log(l,"\u6570\u91CF\u51CF1"),n){let u=e.shopList,d=0;u.forEach(h=>{h.check&&(d+=h.count*h.goodsObj.price)}),e.price=d*100}}),clearTimeout(e.timer)},1e3))},b=async()=>{let t=await K({username:e.user.username}),s=t.result;s.forEach(o=>{o.check=!1}),e.shopList=s,console.log(t,"\u8D2D\u7269\u8F66")};return A(()=>{b()}),D((t,s)=>{a.commit("changeFooter",!0)}),F(E({},J(e)),{getCountChange:m,minusCountFunc:k,countBeforeChange:g,checkAll:_,checkOne:y,onSubmit:V})}},$=T(" \u8D2D\u7269\u8F66 "),ee={class:"shopCar"},oe={class:"checkbox"},te={class:"left"},se={class:"center"},ae={style:{color:"red"}},ce={class:"sl"},ne={class:"right"},re=T("\u5168\u9009");function le(a,c,e,r,V,y){const _=f("t-navbar"),g=f("van-checkbox"),m=f("van-image"),k=f("van-stepper"),b=f("van-submit-bar");return v(),L("div",null,[p(_,null,{default:C(()=>[$]),_:1}),i("ul",ee,[(v(!0),L(z,null,q(a.shopList,(t,s)=>(v(),L("li",{key:s},[i("div",oe,[p(g,{onClick:o=>r.checkOne(o,t._id),modelValue:t.check,"onUpdate:modelValue":o=>t.check=o,name:"a"},null,8,["onClick","modelValue","onUpdate:modelValue"])]),i("div",te,[p(m,{fit:"cover",width:"90",height:"110",src:JSON.parse(t.goodsObj.bannerList)[0].url},null,8,["src"])]),i("div",se,[i("p",ae,"\uFFE5"+O(t.goodsObj.price),1),i("h6",null,O(t.goodsObj.title),1),i("p",ce,O(t.goodsObj.desc),1)]),i("div",ne,[p(k,{"before-change":r.countBeforeChange,onMinus:o=>r.minusCountFunc(o,t.count,t.Id,t.check),onPlus:o=>r.getCountChange(o,t.count,t.Id,t.check),modelValue:t.count,"onUpdate:modelValue":o=>t.count=o,"disable-input":""},null,8,["before-change","onMinus","onPlus","modelValue","onUpdate:modelValue"])])]))),128))]),p(b,{price:a.price,"button-text":"\u63D0\u4EA4\u8BA2\u5355",onSubmit:r.onSubmit},{default:C(()=>[p(g,{onChange:r.checkAll,modelValue:a.checked,"onUpdate:modelValue":c[0]||(c[0]=t=>a.checked=t)},{default:C(()=>[re]),_:1},8,["onChange","modelValue"])]),_:1},8,["price","onSubmit"])])}var pe=U(Z,[["render",le]]);export{pe as default};
