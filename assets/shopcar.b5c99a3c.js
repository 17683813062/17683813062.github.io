var x=Object.defineProperty,B=Object.defineProperties;var w=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var E=(a,n,e)=>n in a?x(a,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[n]=e,y=(a,n)=>{for(var e in n||(n={}))M.call(n,e)&&E(a,e,n[e]);if(j)for(var e of j(n))N.call(n,e)&&E(a,e,n[e]);return a},F=(a,n)=>B(a,w(n));import{_ as U,b as R,d as I,r as P,o as A,e as D,t as J,a as L,c as v,f as p,w as C,g as u,F as z,z as q,n as O,a5 as G,aC as H,aD as K,i as T,j as f,M as Q,aE as W}from"./index.7ae61b15.js";import{g as X,a as Y}from"./utils.5cf54832.js";const Z={beforeRouteEnter(a,n,e){e(r=>{r.store.commit("changeFooter",!1)})},setup(){let a=R(),n=I(),e=P({store:a,timer:null,user:JSON.parse(localStorage.getItem("user")),shopList:[],flag:!0,checked:!1,price:0}),r=async o=>{if(o.length==0){Q.error("\u8BF7\u9009\u62E9\u4E00\u9879");return}let{price:t,user:s}=e,c={list:o,price:t,username:s.username,user:s,timestamp:X(),time:Y()},i=await W(c);n.push({path:"/orderlist"}),console.log(i,"\u63D0\u4EA4\u8BA2\u5355")},V=()=>{let t=e.shopList.filter(s=>s.check);console.log(t,"\u9009\u4E2D\u7684\u8BA2\u5355"),r(t)},S=(o,t)=>{let s=e.shopList,c=0,i=0;s.forEach(l=>{l._id==t&&(l.check=o),l.check&&(i++,c+=l.count*l.goodsObj.price)}),e.shopList=s,e.price=c*100,i==e.shopList.length?e.checked=!0:e.checked=!1},_=o=>{if(o){let t=e.shopList,s=0;t.forEach(c=>{c.check=!0,c.check&&(s+=c.count*c.goodsObj.price)}),e.shopList=t,e.price=s*100}else{let t=e.shopList,s=0;t.forEach(c=>{c.check=!1,c.check&&(s+=c.count*c.goodsObj.price)}),e.shopList=t,e.price=s*100}},g=()=>!!e.flag,m=(o,t,s,c)=>{e.flag&&(e.flag=!1,e.timer=setTimeout(()=>{e.flag=!0,G({_id:s,username:e.user.username}).then(i=>{if(console.log(i,"\u6570\u91CF\u52A01"),c){let l=e.shopList,d=0;l.forEach(h=>{h.check&&(d+=h.count*h.goodsObj.price)}),e.price=d*100}}),clearTimeout(e.timer)},1e3))},b=(o,t,s,c)=>{e.flag&&(e.flag=!1,e.timer=setTimeout(()=>{e.flag=!0,H({_id:s,username:e.user.username}).then(i=>{if(console.log(i,"\u6570\u91CF\u51CF1"),c){let l=e.shopList,d=0;l.forEach(h=>{h.check&&(d+=h.count*h.goodsObj.price)}),e.price=d*100}}),clearTimeout(e.timer)},1e3))},k=async()=>{let o=await K({username:e.user.username}),t=o.result;t.forEach(s=>{s.check=!1}),e.shopList=t,console.log(o,"\u8D2D\u7269\u8F66")};return A(()=>{k()}),D((o,t)=>{a.commit("changeFooter",!0)}),F(y({},J(e)),{getCountChange:m,minusCountFunc:b,countBeforeChange:g,checkAll:_,checkOne:S,onSubmit:V})}},$=T(" \u8D2D\u7269\u8F66 "),ee={class:"shopCar"},oe={class:"checkbox"},se={class:"left"},te={class:"center"},ae={style:{color:"red"}},ne={class:"sl"},ce={class:"right"},re=T("\u5168\u9009");function le(a,n,e,r,V,S){const _=f("t-navbar"),g=f("van-checkbox"),m=f("van-image"),b=f("van-stepper"),k=f("van-submit-bar");return L(),v("div",null,[p(_,null,{default:C(()=>[$]),_:1}),u("ul",ee,[(L(!0),v(z,null,q(a.shopList,(o,t)=>(L(),v("li",{key:t},[u("div",oe,[p(g,{onChange:s=>r.checkOne(s,o._id),modelValue:o.check,"onUpdate:modelValue":s=>o.check=s,name:"a"},null,8,["onChange","modelValue","onUpdate:modelValue"])]),u("div",se,[p(m,{fit:"contain",width:"100",height:"100",src:JSON.parse(o.goodsObj.bannerList)[0].url},null,8,["src"])]),u("div",te,[u("p",ae,"\uFFE5"+O(o.goodsObj.price),1),u("h6",null,O(o.goodsObj.title),1),u("p",ne,O(o.goodsObj.desc),1)]),u("div",ce,[p(b,{"before-change":r.countBeforeChange,onMinus:s=>r.minusCountFunc(s,o.count,o.Id,o.check),onPlus:s=>r.getCountChange(s,o.count,o.Id,o.check),modelValue:o.count,"onUpdate:modelValue":s=>o.count=s,"disable-input":""},null,8,["before-change","onMinus","onPlus","modelValue","onUpdate:modelValue"])])]))),128))]),p(k,{price:a.price,"button-text":"\u63D0\u4EA4\u8BA2\u5355",onSubmit:r.onSubmit},{default:C(()=>[p(g,{onChange:r.checkAll,modelValue:a.checked,"onUpdate:modelValue":n[0]||(n[0]=o=>a.checked=o)},{default:C(()=>[re]),_:1},8,["onChange","modelValue"])]),_:1},8,["price","onSubmit"])])}var pe=U(Z,[["render",le]]);export{pe as default};
