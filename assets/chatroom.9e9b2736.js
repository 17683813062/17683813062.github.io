var T=Object.defineProperty,D=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var O=(e,o,t)=>o in e?T(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,_=(e,o)=>{for(var t in o||(o={}))H.call(o,t)&&O(e,t,o[t]);if(j)for(var t of j(o))B.call(o,t)&&O(e,t,o[t]);return e},g=(e,o)=>D(e,F(o));import{am as J,_ as C,L as E,f as x,r as k,an as f,U as S,o as M,t as y,a as m,c as u,e as l,F as U,p as V,ao as L,n as b,q as R,j as p,C as z,d as v,w as $,i as w,b as G,u as q,ap as I}from"./index.c7734519.js";import{w as A}from"./wangEditor.1601813f.js";var h={socketUrl:J,socket:null,store:null,leave:null,join:null,initRoom:function(e,o,t){this.socket=window.io.connect(this.socketUrl),this.store=t,this.socket.on("connect",()=>{console.log("\u8FDE\u63A5\u6210\u529F"),this.joinRoom(e,o),this.eventData()}),this.socket.on("connecting",()=>{console.log("\u6B63\u5728\u8FDE\u63A5")}),this.socket.on("disconnect",()=>{console.log("\u65AD\u5F00\u8FDE\u63A5")}),this.socket.on("connect_failed",()=>{console.log("\u8FDE\u63A5\u5931\u8D25")}),this.socket.on("error",()=>{console.log("\u9519\u8BEF\u53D1\u751F\uFF0C\u5E76\u4E14\u65E0\u6CD5\u88AB\u5176\u4ED6\u4E8B\u4EF6\u7C7B\u578B\u6240\u5904\u7406")}),this.socket.on("reconnect_failed",()=>{console.log("\u91CD\u8FDE\u5931\u8D25")}),this.socket.on("reconnect",()=>{console.log("\u6210\u529F\u91CD\u8FDE")}),this.socket.on("reconnecting",()=>{console.log("\u6B63\u5728\u91CD\u8FDE")})},joinRoom(e,o){let t={chatId:e,user:o};this.socket.emit("JOINROOM",t),this.socket.on("joinroom",n=>{this.store.commit("joinRoom",n),this.join=!0})},eventData(){this.socket.on("broadcast",e=>{this.store.commit("saveChatList",e)}),this.socket.on("leavebroadcast",e=>{this.store.commit("leaveRoom",e),this.leave=!0})}};const K={name:"ChatContent",props:{chatId:Number},setup(e,o){let t=E(null),n=x(),r=k({msgList:[],manList:[],user:JSON.parse(localStorage.getItem("user"))});return setTimeout(()=>{f(()=>r.msgList,(i,a)=>{console.log("\u6539\u53D8\u4FE1\u606F112121"),o.emit("changeMsgList")})},1e3),f(()=>n.state.chatRoom,(i,a)=>{console.log(i,"new");let s=i.filter(c=>c.chatId==e.chatId);r.msgList=s[0].msgList,r.manList=s[0].manList,o.emit("getManList",s[0].manList),o.emit("leaveRoom"),S(()=>{t.value.scrollTop=t.value.scrollHeight})},{deep:!0}),M(()=>{}),g(_({},y(r)),{chatDom:t})}},P={ref:"chatDom",class:"chatBox"},Q={class:"top"},W=["src"],X=["innerHTML"],Y=["innerHTML"];function Z(e,o,t,n,r,i){return m(),u("div",null,[l("ul",P,[(m(!0),u(U,null,V(e.msgList,(a,d)=>(m(),u("li",{ref_for:!0,ref:e.li_+d,class:L(e.user.username==a.user.username?"chat-item myitem":"chat-item"),key:d},[l("div",Q,[l("img",{src:a.user.headImg,alt:""},null,8,W),l("span",null,b(a.user.username),1)]),a.type=="text"?(m(),u("div",{key:0,class:L(a.type=="text"?"btm text":"btm")},[l("span",{innerHTML:a.text},null,8,X)],2)):R("",!0),a.type=="broadcast"?(m(),u("div",{key:1,class:L(a.type=="broadcast"?"btm broadcast":"btm")},[l("span",{innerHTML:a.text},null,8,Y)],2)):R("",!0)],2))),128))],512)])}var tt=C(K,[["render",Z],["__scopeId","data-v-1ef635aa"]]);const et={name:"ChatFoot",props:{_id:String},setup(e,o){let t=k({editor:null,editorContent:"",editorMaxHeight:0}),n=()=>{t.editorMaxHeight=window.innerHeight-450,t.editor=new A("#toolbar-container","#text-container"),t.editor.config.onchange=function(i){t.editorContent=i},t.editor.create()},r=()=>{o.emit("sendMsg",t.editor.txt.html()),t.editor.txt.html("")};return M(()=>{S(()=>{n()})}),g(_({},y(t)),{send:r})}},ot=l("div",{id:"toolbar-container",class:"toolbar"},null,-1),st=w("\u53D1\u9001");function nt(e,o,t,n,r,i){const a=p("t-button");return m(),u("div",null,[ot,l("div",{id:"text-container",style:z("height:"+e.editorMaxHeight/100+"rem"),class:"text"},null,4),v(a,{onClick:n.send,style:{position:"fixed",right:"0.2rem",bottom:"0.1rem"},size:"small",theme:"primary"},{default:$(()=>[st]),_:1},8,["onClick"])])}var at=C(et,[["render",nt]]);const rt={components:{ChatContent:tt,ChatFoot:at},beforeRouteEnter(e,o,t){t(n=>{n.store.commit("changeFooter",!1)})},setup(){let e=q(),o=x(),t=k({store:o,user:JSON.parse(localStorage.getItem("user")),_id:e.query._id,chatObj:{chatId:"",name:"",desc:"",movice:"",_id:""},length:0}),n=async()=>{},r=async()=>{let s=setTimeout(async()=>{let c=await I({_id:t._id});t.chatObj=c.result[0],t.chatObj.manList=JSON.parse(c.result[0].manList),t.length=t.chatObj.manList.length,clearTimeout(s),console.log("\u6539\u53D8\u4FE1\u606F\u5217\u8868",t.chatObj.manList)},2e3)},i=async s=>{t.manList=s},a=s=>{let c={chatId:t.chatObj.chatId,text:s,type:"text",user:t.user};h.socket.emit("SENDMSG",c)},d=async()=>{let s=await I({_id:t._id});t.chatObj=s.result[0],t.chatObj.manList=JSON.parse(s.result[0].manList),t.length=t.chatObj.manList.length,h.initRoom(t.chatObj.chatId,t.user,o)};return M(()=>{d()}),f(()=>h.join,(s,c)=>{console.log("\u52A0\u5165666666"),s&&(console.log("\u52A0\u5165666666"),h.join=null)},{deep:!0}),f(()=>h.leave,(s,c)=>{s&&(console.log("\u79BB\u5F00666666"),h.leave=null)},{deep:!0}),G((s,c)=>{let N={chatId:t.chatObj.chatId,user:t.user};h.socket.emit("disconnected",N),o.commit("changeFooter",!0)}),g(_({},y(t)),{sendMsg:a,getManList:i,changeMsgList:n,leaveRoom:r})}},it={class:"chatDetail"};function ct(e,o,t,n,r,i){const a=p("t-navbar"),d=p("ChatContent"),s=p("ChatFoot");return m(),u("div",it,[v(a,null,{default:$(()=>[w(b(e.chatObj.name)+" "+b("("+e.length+")"),1)]),_:1}),v(d,{onLeaveRoom:n.leaveRoom,onChangeMsgList:n.changeMsgList,onGetManList:n.getManList,chatId:e.chatObj.chatId,class:"ChatContent"},null,8,["onLeaveRoom","onChangeMsgList","onGetManList","chatId"]),v(s,{onSendMsg:n.sendMsg,_id:e._id,class:"ChatFoot"},null,8,["onSendMsg","_id"])])}var mt=C(rt,[["render",ct],["__scopeId","data-v-61fd50ef"]]);export{mt as default};
