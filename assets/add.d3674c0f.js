var I=Object.defineProperty,U=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var b=(o,l,e)=>l in o?I(o,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[l]=e,F=(o,l)=>{for(var e in l||(l={}))M.call(l,e)&&b(o,e,l[e]);if(C)for(var e of C(l))N.call(l,e)&&b(o,e,l[e]);return o},S=(o,l)=>U(o,E(l));import{_ as O,b as D,u as j,d as A,r as J,B as P,o as Q,e as q,t as G,a as g,c as p,g as d,f as i,w as c,n as V,F as L,C as R,L as H,M as m,aQ as K,aR as W,T as X,aO as Y,i as f,j as _}from"./index.9ec2ea3d.js";import{g as B,a as Z}from"./utils.1c13dd23.js";const $={beforeRouteEnter(o,l,e){e(r=>{r.store.commit("changeFooter",!1)})},setup(){let o=D();j();let l=A(),e=J({store:o,user:JSON.parse(localStorage.getItem("user")),text:"",serverUrl:P+"/movecase/",fileList1:[],talkList:[],talkList1:[],show:!1,addTalkText:"",tag:"",tagId:""}),r=t=>{e.tag=t.title,e.tagId=t._id,e.show=!1},w=t=>{console.log(t);let s=e.talkList.filter(n=>(console.log(n.title,t,n.title.indexOf(t)!=-1),n.title.indexOf(t)!=-1));e.talkList1=s},x=async()=>{if(!e.addTalkText)m.error("\u8FD8\u672A\u586B\u5199");else{let t={title:e.addTalkText,count:0,timestamp:B()},a=await K(t);a.code==1?(m.success(a.msg),e.addTalkText="",h()):m.error(a.msg)}},k=()=>{e.show=!0},v=async()=>{let{text:t,fileList1:a,tag:s,tagId:n}=e;if(!s||!n){m.error("\u8BF7\u9009\u62E9\u5BC6\u5BA4\uFF01\uFF01\uFF01");return}else if(t||a.length){let T={user:e.user,username:e.user.username,text:t,fileList1:a,tag:s,tagId:n,time:Z(),timestamp:B()},z=await W(T);console.log(z,"\u6DFB\u52A0\u52A8\u6001\u6210\u529F"),m.success("\u6DFB\u52A0\u52A8\u6001\u6210\u529F"),l.go(-1)}else m.error("\u8FD8\u6709\u672A\u586B\u5199")},u=t=>{e.fileList1.splice(t,1)},y=t=>{console.log(t),t.length||(t=[t]);var a=new FormData;a.enctype="multipart/form-data",t.forEach(function(s){a.append("myfile",s.file)}),X(a).then(s=>{let n=e.fileList1;s.fileList.forEach(T=>{n.push({url:e.serverUrl+T.filename})}),e.fileList1=n,console.log("\u4E0A\u4F20\u6210\u529F1",e.fileList1,n)})},h=async()=>{let t=await Y();e.talkList=t.result,e.talkList1=t.result,console.log(t,"\u67E5\u627E\u6240\u6709\u8BDD\u9898")};return Q(()=>{h()}),q((t,a)=>{o.commit("changeFooter",!0)}),S(F({},G(e)),{afterRead:y,removeFileList:u,submit:v,addTalk:k,addTalkFunc:x,filterList:w,addTagList:r})}},ee={class:"main"},te=f(" \u6DFB\u52A0 "),ae={class:"content"},oe=f("\u8BF7\u8F93\u5165\u6587\u5B57 "),le={style:{display:"inline-block",width:"70%"}},se=f("\u9009\u62E9\u5BC6\u5BA4"),re={class:"fileList"},ne=["onClick"],ie={style:{width:"100%"}},de=f("\u53D6\u6D88"),ce=f("\u786E\u8BA4"),ue=f("\u6DFB\u52A0"),me={class:"tagBox"},_e=["onClick"];function fe(o,l,e,r,w,x){const k=_("t-navbar"),v=_("t-textarea"),u=_("t-button"),y=_("van-uploader"),h=_("t-input"),t=_("van-dialog");return g(),p(L,null,[d("div",ee,[i(k,null,{default:c(()=>[te]),_:1}),d("div",ae,[i(v,{style:{"padding-bottom":"0.2rem","max-height":"8rem"},autosize:"",modelValue:o.text,"onUpdate:modelValue":l[0]||(l[0]=a=>o.text=a),maxcharacter:400},{default:c(()=>[oe]),_:1},8,["modelValue"]),d("span",le,V(o.tag),1),i(u,{style:{width:"30%"},onClick:r.addTalk,theme:"primary",size:"small"},{default:c(()=>[se]),_:1},8,["onClick"])]),d("div",null,[d("ul",re,[(g(!0),p(L,null,R(o.fileList1,(a,s)=>(g(),p("li",{onClick:n=>r.removeFileList(s),key:s},[d("div",{style:H("background: url("+a.url+") top center no-repeat;background-size: cover;"),class:"imgBox"},null,4)],8,ne))),128))]),i(y,{multiple:"","after-read":r.afterRead},null,8,["after-read"])]),d("div",ie,[i(u,{style:{float:"right","margin-left":"0.2rem"},theme:"ghost"},{default:c(()=>[de]),_:1}),i(u,{onClick:r.submit,style:{float:"right"},theme:"primary"},{default:c(()=>[ce]),_:1},8,["onClick"])])]),i(t,{show:o.show,"onUpdate:show":l[2]||(l[2]=a=>o.show=a),title:"\u6DFB\u52A0\u5BC6\u5BA4","show-cancel-button":""},{default:c(()=>[i(u,{onClick:r.addTalkFunc,theme:"primary",size:"small"},{default:c(()=>[ue]),_:1},8,["onClick"]),i(h,{onChange:r.filterList,modelValue:o.addTalkText,"onUpdate:modelValue":l[1]||(l[1]=a=>o.addTalkText=a),style:{width:"70%",display:"inline-block","margin-left":"5%"},placeholder:"\u5BC6\u5BA4\u540D\u79F0"},null,8,["onChange","modelValue"]),d("ul",me,[(g(!0),p(L,null,R(o.talkList1,a=>(g(),p("li",{onClick:s=>r.addTagList(a),key:a},V(a.title),9,_e))),128))])]),_:1},8,["show"])],64)}var ke=O($,[["render",fe],["__scopeId","data-v-a6ea9ce8"]]);export{ke as default};
